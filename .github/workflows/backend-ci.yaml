name: Backend CI
on:
  workflow_dispatch:
  push:
    branches:
      - 'main'
concurrency:
  group: backend
  cancel-in-progress: true
jobs:
  linter:
    uses: zeitonline/gh-action-workflows/.github/workflows/pre-commit.yaml@46b696216ed1e1e4b945cfacb2f7f2a27e3e2a78 # 2.4.2
  build:
    uses: zeitonline/gh-action-workflows/.github/workflows/build-test-push.yaml@46b696216ed1e1e4b945cfacb2f7f2a27e3e2a78 # 2.4.2
    needs:
      - linter
    secrets: inherit
    with:
      targets: $none  # dummy target in order to run "release-please"
  notify:
    uses: zeitonline/gh-action-workflows/.github/workflows/release-notification.yaml@46b696216ed1e1e4b945cfacb2f7f2a27e3e2a78 # 2.4.2
    needs:
      - build
    if: needs.build.outputs.release_created
    secrets: inherit
    with:
      environment: production
      version: ${{ needs.build.outputs.tag_name }}
      emoji: mailbox
